<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新增採購單</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="p-4">
<h2>新增採購單</h2>
<form th:action="@{/purchases/save}" method="post">
    <div class="mb-3">
        <label class="form-label">供應商</label>
        <select name="supplierId" class="form-select" required>
            <option th:each="s : ${suppliers}" th:value="${s.id}" th:text="${s.name}"></option>
        </select>
    </div>

    <h5>商品明細</h5>
    <table class="table table-bordered" id="detailsTable">
        <thead>
        <tr><th>商品</th><th>數量</th><th>操作</th></tr>
        </thead>
        <tbody id="detailRows">
        <tr>
            <td>
                <select name="productIds" class="form-select" required>
                    <option th:each="p : ${products}" th:value="${p.id}" th:text="${p.name} + '（$' + p.price + '）'"></option>
                </select>
            </td>
            <td><input type="number" name="quantities" class="form-control" min="1" required></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">刪除</button></td>
        </tr>
        </tbody>
    </table>

    <div class="mb-3">
        <button type="button" class="btn btn-secondary" onclick="addRow()">新增商品</button>
    </div>

    <button class="btn btn-success" type="submit">儲存</button>
    <a class="btn btn-secondary" th:href="@{/purchases}">取消</a>
</form>

<script>
function addRow() {
    const row = document.querySelector('#detailRows tr');
    const newRow = row.cloneNode(true);
    newRow.querySelectorAll('input').forEach(input => input.value = '');
    document.getElementById('detailRows').appendChild(newRow);
}

function removeRow(button) {
    const rows = document.querySelectorAll('#detailRows tr');
    if (rows.length > 1) {
        button.closest('tr').remove();
    }
}
</script>
</body>
</html>
