<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>商品上架</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link href="/product.css" rel="stylesheet">
</head>

<body>
  <form method="post" th:action="@{/products/publish/update}" class="mt-4">
    <div class="container">
      <!-- 提示訊息區塊 -->
       <div th:if="${successMessage}" class="alert alert-success text-center fw-bold">
	      <i class="bi bi-check-circle me-1"></i>
	      <span th:text="${successMessage}"></span>
	    </div>
     	<div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

      <div class="card shadow-sm rounded-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-box-seam me-2"></i>商品上架管理</h5>
        </div>
        <div class="card-body p-4">
          <table class="table table-hover align-middle text-center">
            <colgroup>
              <col style="width: 80px;">
              <col style="width: 150px;">
              <col style="width: 120px;">
              <col style="width: 320px;">
              <col style="width: 100px;">
              <col style="width: 100px;">
              <col style="width: 120px;">
            </colgroup>
            <thead class="table-light">
              <tr>
                <th>圖片</th>
                <th>
                  商品名稱
                  <a th:href="@{/products/publish(sort='name')}" class="text-decoration-none"><i class="bi bi-arrow-down-up"></i></a>
                </th>
                <th>分類</th>
                <th>描述</th>
                <th>價格</th>
                <th>庫存</th>
                <th>
                  是否上架
                  <input type="checkbox" id="toggleAll" class="form-check-input ms-2">
                </th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="p : ${products}">
                <td>
				  <img th:if="${imageMap[p.id]} != null"
				       th:src="'data:image/png;base64,' + ${imageMap[p.id]}"
				       alt="商品圖片" class="img-thumbnail" style="max-width: 60px;">
				</td>
                <td th:text="${p.name}" class="fw-semibold"></td>
             
               <td th:text="${#strings.listJoin(p.ageRanges, ', ')}">-</td>
                <td th:text="${p.note}" class="text-muted small"></td>
                   <td>
                  <input type="hidden" name="productIds" th:value="${p.id}" />
                  <input type="text" name="prices" th:value="${p.price}" class="form-control text-end" />
                </td>
                <td th:text="${stockMap[p.id]}"></td>
                <td>
                  <div class="form-check d-inline-block">
                    <input class="form-check-input" type="checkbox" name="publishedIds"
                      th:value="${p.id}" th:checked="${p.published}" id="checkbox-[[${p.id}]]">
                    <label class="form-check-label" th:for="'checkbox-' + ${p.id}">上架</label>
                  </div>
                </td>
            
              </tr>
            </tbody>
          </table>
          <div class="text-end mt-3">
            <button type="submit" class="btn btn-success px-4">
              <i class="bi bi-save2 me-1"></i>儲存設定
            </button>
            <a class="btn btn-outline-secondary" th:href="@{/}">
              <i class="bi bi-arrow-left-circle me-1"></i>返回
            </a>
          </div>
        </div>
      </div>
    </div>
  </form>

  <script>
    document.getElementById('toggleAll').addEventListener('change', function () {
      document.querySelectorAll('input[name="publishedIds"]').forEach(cb => cb.checked = this.checked);
    });
  </script>
</body>

</html>
