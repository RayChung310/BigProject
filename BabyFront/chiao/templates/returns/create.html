<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>建立退貨單</title>
    <meta charset="UTF-8">
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<h2>建立退貨單</h2>

<!-- 選擇原始訂單 -->
<form method="get" th:action="@{/returns/create}">
    <label>選擇原始銷貨訂單：</label>
    <select name="orderId" onchange="this.form.submit()">
        <option th:each="order : ${orders}" th:value="${order.id}" 
                th:text="'訂單編號: ' + ${order.id} + ' (' + ${order.customer.name} + ')'" 
                th:selected="${selectedOrder != null} ? ${order.id} == ${selectedOrder.id} : false">
        </option>
    </select>
</form>

<!-- 顯示訂單商品明細 -->
<div th:if="${selectedOrder != null}">
    <form method="post" th:action="@{/returns/create}">
        <input type="hidden" name="orderId" th:value="${selectedOrder.id}"/>
        <table border="1">
            <thead>
                <tr><th>產品</th><th>單價</th><th>可退數量</th><th>退貨數量</th></tr>
            </thead>
            <tbody>
                <tr th:each="detail : ${selectedOrder.details}">
                    <td th:text="${detail.product.name}"></td>
                    <td>
                        <input type="hidden" name="productId" th:value="${detail.product.id}"/>
                        <input type="hidden" name="unitPrice" th:value="${detail.unitPrice}"/>
                        <span th:text="${detail.unitPrice}"></span>
                    </td>
                    <td th:text="${detail.qty}"></td>
                    <td><input type="number" name="qty" value="0" min="0" th:max="${detail.qty}"/></td>
                </tr>
            </tbody>
        </table>
        <label>退貨原因：</label>
        <input type="text" name="reason"/>
        <button type="submit">提交退貨單</button>
    </form>
</div>

</body>
</html>